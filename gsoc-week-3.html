<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta id="viewport" name="viewport" content="width=500" />
    <!--RSS FEEDS-->
        <link rel="alternate"  href="/feeds/all.atom.xml" type="application/atom+xml" title="Marginally Stable Full Atom Feed"/>

    <title>GSoC Week 3: Generalized Linearizer Class // Marginally Stable</title>
    <link rel="stylesheet" href="/theme/css/normalize.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/base.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/code.css" type="text/css" />
<link rel="stylesheet" href="/theme/css/article.css" type="text/css" />
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
            TeX: { equationNumbers: { autoNumber: "all" } }
        });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
    <!--Top image-->
    <div class="container">
        <div class="topimage">
            <img src="/theme/images/logo.png">
        </div>
    </div>

    <!--Links and site title-->
    <div class="topbar">
        <span><a href="/">Marginally Stable</a></span>
        <ul>
                <li><a href="/blog.html">Blog</a></li>
                <li><a href="/pages/about.html">About</a></li>
                <li><a href="https://github.com/jcrist/AIOs">AIOS</a></li>
        </ul>
    </div>
    <!--Content, footer, and scripts-->
    <div class="container">
    <div class="page-title">
        <h1>GSoC Week 3: Generalized Linearizer Class</h1>
        <p>Fri 06 June 2014 &mdash; under
            <a class="post-category" href="/tag/gsoc.html">GSoC</a>,
            <a class="post-category" href="/tag/sympy.html">sympy</a>,
            <a class="post-category" href="/tag/pydy.html">pydy</a>,
            <a class="post-category" href="/tag/dynamics.html">dynamics</a>
        </p>
    </div>
    <p>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This week I refactored the <code>Linearizer</code> class to fit a general system of
equations. This means that any of the following can be absent, and the
linearization still is valid:</p>
$$
\begin{array}[rl]
\\f_{c}(q, t) &= 0_{lx1} \\
f_{v}(q, u, t) &= 0_{mx1} \\
f_{a}(q, \dot{q}, u, \dot{u}, t) &= 0_{mx1} \\
f_{0}(q, \dot{q}, t) + f_{1}(q, u, t) &= 0_{nx1} \\
f_{2}(q, \dot{u}, t) + f_{3}(q, \dot{q}, u, r, t) &= 0_{(o-m)x1} \\
\end{array}
$$<p>with</p>
$$
\begin{array}[rl]
\\q, \dot{q} & \in \mathbb{R}^n \\
u, \dot{u} & \in \mathbb{R}^o \\
r & \in \mathbb{R}^s 
\end{array}
$$<p>Note that vectors can be absent too. This means the system can be entirely $q$ 
or $u$ components. More on this later.</p>
<p>Much of the rest of the week was spent finishing up all methods related to the
<code>KanesMethod</code> class. This was mostly cleaning up the code base, and fixing
all the tests in place for the previous <code>linearize</code> method. As of this point,
the linearization routines accomplish everything that was in place before, but
in a more general and extensible way. This is all included in the
<code>LinearizerClass</code> branch on my GitHub repo. There is a pull request on my own
master branch open right now for code review
<a href="https://github.com/jcrist/sympy/pull/1">here</a>. I'll leave this up for another
day or two before closing it and making all pull request to <code>Sympy/master</code>.</p>
<p>I also started work on linearizing a system of equations presented in matrix
form. This still needs lots of code improvements (it's inefficient), but
it currently works. Below is a demo.</p>
<p>The system is the same system I use for my research - a dual solenoid actuator.
There are two dependent variables: <code>lam1</code> and <code>lam2</code>. The dynamics are thus
expressed by 3 dynamic differential equations, and two constraint equations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">Matrix</span>
<span class="kn">from</span> <span class="nn">sympy.physics.mechanics</span> <span class="k">import</span> <span class="n">dynamicsymbols</span><span class="p">,</span> <span class="n">mprint</span>
<span class="kn">from</span> <span class="nn">sympy.physics.mechanics.linearize</span> <span class="k">import</span> <span class="n">Linearizer</span><span class="p">,</span> <span class="n">matrix_to_linearizer</span>

<span class="c1"># Create constant symbols</span>
<span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;B1, B2&#39;</span><span class="p">)</span>
<span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;d1, d2, D&#39;</span><span class="p">)</span>
<span class="n">R1</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;R1, R2&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="c1"># Create dynamicsymbols</span>
<span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s1">&#39;i1, i2&#39;</span><span class="p">)</span>
<span class="n">V1</span><span class="p">,</span> <span class="n">V2</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s1">&#39;V1, V2&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">xdot</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">lam1</span><span class="p">,</span> <span class="n">lam2</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s1">&#39;lam1, lam2&#39;</span><span class="p">)</span>
<span class="n">lam1dot</span><span class="p">,</span> <span class="n">lam2dot</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s1">&#39;lam1, lam2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define vectors. Because all speeds are derivatives of the coordinates,</span>
<span class="c1"># the system is best represented as just a vector of u. The dependent</span>
<span class="c1"># states are lam1 and lam2</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">xdot</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam1</span><span class="p">,</span> <span class="n">lam2</span><span class="p">])</span>
<span class="n">udep</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>

<span class="c1"># Define system of equations</span>
<span class="n">eom</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">B1</span><span class="o">/</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">i1</span> <span class="o">-</span> <span class="n">lam1</span><span class="p">,</span>
              <span class="n">B2</span><span class="o">/</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="n">d2</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">i2</span> <span class="o">-</span> <span class="n">lam2</span><span class="p">,</span>
              <span class="o">-</span><span class="n">lam1dot</span> <span class="o">-</span> <span class="n">R1</span><span class="o">*</span><span class="n">i1</span> <span class="o">+</span> <span class="n">V1</span><span class="p">,</span>
              <span class="o">-</span><span class="n">lam2dot</span> <span class="o">-</span> <span class="n">R2</span><span class="o">*</span><span class="n">i2</span> <span class="o">+</span> <span class="n">V2</span><span class="p">,</span>
              <span class="o">-</span><span class="n">xdot</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">B2</span><span class="o">/</span><span class="p">(</span><span class="n">d2</span> <span class="o">+</span> <span class="n">D</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">B1</span><span class="o">/</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="p">])</span>

<span class="c1"># Perform the linearization</span>
<span class="n">linearizer</span> <span class="o">=</span> <span class="n">matrix_to_linearizer</span><span class="p">(</span><span class="n">eom</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">udep</span><span class="o">=</span><span class="n">udep</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">linearizer</span><span class="o">.</span><span class="n">linearize</span><span class="p">(</span><span class="n">A_and_B</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mprint</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Matrix([
[(B1*x&#39; - R1*(d1 + x)**2)/(B1*(d1 + x)),                                               0,                        ((d1 + x)*i1&#39; - 2*i1*x&#39;)/(d1 + x)**2,      2*i1/(d1 + x)],
[                                     0, -(B2*x&#39; + R2*(D + d2 - x)**2)/(B2*(D + d2 - x)),               -((D + d2 - x)*i2&#39; + 2*i2*x&#39;)/(D + d2 - x)**2, -2*i2/(D + d2 - x)],
[                                     0,                                               0,                                                           0,                  1],
[              -2*B1*i1/(m*(d1 + x)**2),                     2*B2*i2/(m*(D + d2 - x)**2), 2*B1*i1**2/(m*(d1 + x)**3) + 2*B2*i2**2/(m*(D + d2 - x)**3),                  0]])
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mprint</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Matrix([
[(d1 + x)/B1,               0],
[          0, (D + d2 - x)/B2],
[          0,               0],
[          0,               0]])
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You'll have to trust me that the above representations are the same ones that I derived for my research project. This is really exciting progress! If everything works out (and it looks like it will), it will be possible to derive a system of dynamic equations anywhere in sympy, and then linearize it using the functionality I implement in the <code>linearize</code> function.</p>
<p>Currently the system of equations is must formed as a matrix, and then passed
to <code>matrix_to_linearizer</code> to return a <code>Linearizer</code> object. Once this code is
cleaned up, it will be used internally by the general <code>linearize</code> function to
convert the system to a <code>Linearizer</code>, perform the linearization, and return
the results. I plan on implementing this functionality next week.</p>
<p>The code used above is found in my <code>matrix2linearizer</code> branch on GitHub <a href="https://github.com/jcrist/sympy/tree/matrix2linearizer">here</a>. As before, I made a pull request on my own rep, so people may review the code before i submit it to Sympy proper. The PR is <a href="https://github.com/jcrist/sympy/pull/2">here</a>.</p>

</div>
</div>
</div></p>

    <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "marginallystable"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

<div class="container bottom">
    <hr>
    <p>
        All content copyright 2014-2016 Jim Crist unless otherwise noted.
        Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a>.
    </p>
    <p>
    Find me on <a href="https://twitter.com/jiminy_crist">Twitter</a>, <a 
        href="https://github.com/jcrist">GitHub</a>, <a
        href="https://speakerdeck.com/jcrist">Speaker Deck</a>, or shoot me an <a
    href="mailto:jiminy.crist@gmail.com">email</a>.
    </p>
</div>    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-40063290-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
    </div>
</body>
</html>